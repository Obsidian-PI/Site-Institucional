<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Cadastro Obsidian</title>
    <link rel="stylesheet" href="./css/style.css">
    <link rel="shortcut icon" href="../assets/ico.png" type="image/x-icon">
</head>

<body>
    <a class="ADM" href="../administrador/dash.html">
    </a>
    <div class="box" id="box1">
        <div class="up">
            <a href="../index.html">
                <img src="./assets/imgs/iconLeft.png" alt="">
            </a>
        </div>
        <div class="Cadastro">
            <div class="tituloCadastro">
                <p>Criar conta na</p>
                <div class="logoCadastro">
                    <img src="./assets/imgs/logoLogin.png" alt="">
                    <p>Obsidian</p>
                </div>
            </div>
            <div class="headerText">
                <p>Insira os dados da Empresa:</p>
            </div>
            <div class="formsCadastro">
                <div class="info">
                    <input id="razaoSocial" type="text" placeholder="razao social">
                    <input id="nomeFEmpresa" type="text" placeholder="nome fantasia">
                    <input id="cnpjEmpresa" type="text" placeholder="cnpj">
                </div>
            </div>
            <div class="botoesCadastro">
                <button class="cadastrar" onclick="proximo()">Proximo</button>
            </div>
            <div class="crieConta">
                <p>Ja possui uma conta na </p> <a href="../login/login.html">Obsidian?</a>
            </div>
            <div class="progress">
                <div class="bola atual"></div>
                <div class="bola"></div>
            </div>
        </div>
    </div>

    <div class="box" id="box2">
        <div class="up">
            <a onclick="voltar()">
                <img src="./assets/imgs/iconLeft.png" alt="">
            </a>
        </div>
        <div class="Cadastro">
            <div class="tituloCadastro">
                <p>Criar conta na</p>
                <div class="logoCadastro">
                    <img src="./assets/imgs/logoLogin.png" alt="">
                    <p>Obsidian</p>
                </div>
            </div>
            <div class="headerText">
                <p>Insira os seus dados:</p>
            </div>
            <div class="formsCadastro">
                <div class="info">
                    <input id="nomeFunc" type="text" placeholder="nome">
                    <input id="emailFunc" type="text" placeholder="email Corporativo">
                    <input id="cpf" type="text" placeholder="cpf">
                </div>
            </div>
            <div class="botoesCadastro">
                <button class="cadastrar" onclick="enviar()">Enviar requisição</button>
            </div>
            <div class="crieConta">
                <p>Ja possui uma conta na </p> <a href="../login/login.html">Obsidian?</a>
            </div>
            <div class="progress">
                <div class="bola"></div>
                <div class="bola atual"></div>
            </div>
        </div>
    </div>
</body>

</html>

<script>

    box2.style.display = 'none';

    function proximo() {
        box1.style.display = 'none';
        box2.style.display = 'block';
    }

    function voltar() {
        box1.style.display = 'block';
        box2.style.display = 'none';
    }


    function enviar() {
        var razaoVar = razaoSocial.value;
        var nomeFanVar = nomeFEmpresa.value;
        var cnpjVar = cnpjEmpresa.value;
        var nomeFuncVar = nomeFunc.value;
        var emailFuncVar = emailFunc.value;
        var cpfVar = cpf.value;

        console.log(`${razaoVar}\n
                    ${nomeFanVar}\n
                    ${cnpjVar}\n
                    ${nomeFuncVar}\n
                    ${emailFuncVar}\n
                    ${cpfVar}`)

        // validação feita pelo Rodolfo, pendente de teste
        if (!nomeVar || !emailVar || !cnpjVar || ufVar == "UF" || atuacaoVar == "Área de atuação" || !senhaVar || !confirmacaoSenhaVar) {
            alert("Por favor, preencha todos os campos.");
            return false;
        }

        var emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
        /* 
        /^ indica o inicio, [^\s@] onde vamos receber o email garantindo que não haverá espaço ou caractere especial
           +@ indica o arroba após a primeira parte do texto, temos o recebimento do dominio, a obrigatoriedade do ponto e $ para 
           apontar o final
        */
        if (!emailRegex.test(emailVar)) {
            alert("Por favor, insira um email válido.");
            return false;
        }

        if (senhaVar != confirmacaoSenhaVar) {
            alert("As senhas não coincidem.");
            return false;
        }

        // inicio dos métodos de adição no banco de dados, caso os dados inseridos estejam válidos

        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                razaoServer: razaoVar,
                nomeFanServer: nomeFanVar,
                cnpjServer: cnpjVar,
            }),
        })
            .then(function (resposta) {
                console.log("resposta: ", resposta);

                if (resposta.ok) {

                    setTimeout(() => {
                        window.location = "../login/login.html";
                    }, "2000");

                } else {
                    throw "Houve um erro ao tentar realizar o cadastro!";
                }
            })
            .catch(function (resposta) {
                console.log(`#ERRO: ${resposta}`);
                finalizarAguardar();
            });

        return false;
    }
</script>